# LangChain 財務顧問 AI Agent

這個專案展示了如何使用 LangChain 創建一個智能財務顧問 AI Agent，讓學員能夠輕鬆理解從簡單 QA 到智能 Agent 的進化過程。

## 🎯 學習目標

透過這個範例，你將學會：
- 理解 RAG（檢索增強生成）的基本原理
- 如何使用 LangChain 的內建搜尋工具
- 如何讓 Agent 自動決定何時使用搜尋工具
- 如何整合知識庫和網路資訊來回答問題

## 🛠️ 功能特色

這個財務顧問 AI Agent 擁有以下智慧功能：

1. **網路搜尋工具** (`web_search`) - 自動搜尋最新資訊（股價、新聞等）
2. **財務分析工具** (`financial_analysis`) - 提供專業投資建議
3. **知識庫整合** - 結合靜態知識和動態網路資訊

### 核心特色：
- **自動決策**：Agent 會自行決定何時需要搜尋外部資訊
- **即時資訊**：透過網路搜尋獲取最新股價和新聞
- **專業分析**：提供基於知識庫的財務建議
- **智慧整合**：將多種資訊來源整合成連貫的回答

## 🚀 快速開始

### 1. 安裝依賴

```bash
# 使用 uv（推薦）
uv sync

# 或使用 pip
pip install -r requirements.txt
```

### 2. 準備知識庫文件

請確保目錄中有一個 PDF 文件：`202502_6625_AI1_20250924_142829.pdf`

### 3. 運行財務顧問 Agent

```bash
# 運行主要 Agent
uv run python main.py

# 運行自動示範
uv run python demo.py

# 運行測試
uv run python test_final.py
```

### 4. 體驗 Agent 的智慧功能

試試這些問題來體驗 Agent 的自動決策能力：

- 「蘋果股價多少？」（Agent 會自動搜尋最新股價）
- 「分析蘋果公司的投資價值」（結合知識庫和搜尋結果）
- 「最近科技股有什麼新聞？」（自動搜尋最新新聞）
- 「我想投資電動車產業，你有什麼建議？」（整合多種資訊）
- 「台積電股價怎麼樣？」（支援台股查詢）
- 「必應整體是賺錢的嗎？」（知識庫查詢）

## 📋 程式結構

```
main.py              # 主程式 - 財務顧問 AI Agent
demo.py             # 自動示範腳本 - 展示 Agent 功能
test_final.py       # 最終測試腳本 - 驗證系統功能
pyproject.toml      # 專案配置和依賴
README.md          # 這個說明文件
LEARNING_GUIDE.md  # 詳細學習指南
run_examples.py     # 版本運行器（保留作為學習參考）
versions/           # 舊版本範例（學習用途）
```

## 🔧 自訂設置

### 修改 LLM 模型

在 `main.py` 中找到這行程式碼：

```python
llm = ChatOllama(
    model="gemma3:1b",  # 你可以改成其他模型
    temperature=0.1
)
```

你可以改成其他模型，例如：
- `llama2:7b`
- `mistral:7b`
- `codellama:7b`

### 修改系統提示

Agent 的智慧來自於系統提示，你可以修改 `main.py` 中的系統提示來改變 Agent 的行為：

```python
system_prompt = """
你是一個專業的財務顧問 AI Agent，能夠幫助用戶做出明智的投資決策。

你可以使用以下工具：
1. web_search - 網路搜尋工具，可以搜尋任何最新資訊（股價、新聞、財務數據等）
2. financial_analysis - 提供財務分析建議

請仔細分析用戶的問題並決定是否需要使用工具：
- 如果用戶詢問股價，請使用 web_search 工具搜尋「[公司名稱] 股價」
- 如果用戶詢問最新新聞，請使用 web_search 工具搜尋相關主題
- 如果用戶需要財務分析建議，使用 financial_analysis 工具
- 如果用戶詢問知識庫中的資訊，直接回答即可

請用專業、客觀的語氣回答，並清楚說明你的分析依據。
"""
```

### 新增搜尋來源

目前使用的是 DuckDuckGo 搜尋，你可以修改 `web_search` 工具來使用其他搜尋引擎或 API。

## 🎓 教學重點

### 1. 網路搜尋工具的設計
- 使用 LangChain 的內建搜尋工具（ddgs）
- 讓 LLM 自行決定搜尋內容和時機
- 處理網路請求失敗的情況

### 2. Agent 的自動決策機制
- 系統提示指導 Agent 何時使用工具
- Agent 會自動分析用戶意圖
- 支援動態工具調用而非固定規則

### 3. 知識庫與網路資訊的整合
- 靜態知識庫提供基礎資訊
- 網路搜尋提供即時數據
- Agent 智慧整合兩種資訊來源

### 4. 財務顧問的專業性
- 專業的財務分析建議
- 客觀的投資觀點
- 清楚的分析依據說明

## 🔍 觀察 Agent 的思考過程

當你運行程式時，會看到 Agent 的詳細思考過程：

```
🔍 財務顧問分析問題：蘋果股價多少？
------------------------------
🤔 思考：用戶詢問蘋果股價，我應該使用 web_search 工具搜尋最新股價...
🔧 使用工具：web_search
📊 工具結果：蘋果公司股價查詢結果...
🤖 最終回答：根據最新搜尋結果，蘋果當前股價是...
```

Agent 會：
1. **分析用戶意圖**：理解用戶想要查詢股價
2. **自動選擇工具**：決定使用 web_search 工具
3. **執行網路搜尋**：獲取最新股價資訊
4. **整合資訊**：將搜尋結果轉化為專業回答

## 🐛 常見問題

### 問題：知識庫載入失敗
解決方案：程式會自動處理 PDF 不存在的情況，使用預設知識庫。如果你有財務相關的 PDF 文件，可以放在專案目錄中。

### 問題：LLM 模型載入失敗
解決方案：
1. 確保已安裝並運行 Ollama：`ollama serve`
2. 下載所需的模型：`ollama pull gemma3:1b`

### 問題：網路搜尋失敗
解決方案：
1. 檢查網路連線是否正常
2. 如果搜尋服務暫時不可用，Agent 會繼續使用知識庫回答問題
3. 你可以嘗試修改搜尋工具來使用其他搜尋引擎

### 問題：Agent 沒有使用搜尋工具
解決方案：檢查系統提示是否正確指導 Agent 何時使用工具。如果問題很簡單，Agent 可能會選擇直接回答而不需要搜尋。

## 📚 延伸學習

完成這個範例後，你可以嘗試：

1. **整合真實財務 API**：串接 Yahoo Finance、Alpha Vantage 等專業財務數據 API
2. **增強搜尋功能**：添加更多搜尋來源（如 Google News、財經網站）
3. **增強知識庫**：支援多個 PDF 文件，建立更豐富的財務知識庫
4. **對話記憶功能**：讓 Agent 記住用戶的投資偏好和歷史查詢
5. **進階 Agent 架構**：嘗試 ReAct、Plan-and-Execute 等架構
6. **部署為 Web 服務**：將 Agent 打包成 API 服務供他人使用

## 🎯 下一步建議

1. **試試示範功能**：運行 `uv run python demo.py` 來觀察 Agent 的自動決策過程
2. **嘗試互動體驗**：運行 `uv run python main.py` 來親自與 Agent 對話
3. **修改系統提示**：試著調整系統提示來改變 Agent 的行為風格
4. **探索網路搜尋**：觀察 Agent 如何決定何時使用搜尋工具獲取最新資訊
5. **嘗試不同模型**：更換不同的 LLM 模型來比較回答品質

祝學習愉快！🎊

## 💡 這個設計的核心價值

這個財務顧問 AI Agent 展示了 LangChain Agent 的真正價值：

- **智慧決策**：Agent 能理解用戶意圖並自動選擇最適當的工具
- **即時資訊**：透過網路搜尋獲取最新市場數據和新聞
- **專業建議**：提供基於知識和數據的財務分析
- **學習價值**：清楚展示了從簡單 QA 到智能 Agent 的進化過程

這個範例非常適合教學，因為它：
- 功能強大卻架構清晰
- 展示了真實世界的應用場景
- 讓學員能夠立即看到 Agent 的智慧行為
